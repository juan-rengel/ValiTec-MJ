<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Valitec MJ - Dashboard</title>
  <link rel="stylesheet" href="dashboard.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<body>
  <div id="particles"></div>

  <header>
    <div class="logo">âš™ï¸ Valitec MJ</div>
    <div class="menu-btn" id="menuBtn">â˜°</div>
  </header>

  <nav id="menu">
    <ul>
      <li onclick="showSection('dashboard')">ğŸ“Š Dashboard</li>
      <li onclick="showSection('produtos')">ğŸ›’ Produtos</li>
      <li onclick="showSection('graficos')">ğŸ“ˆ GrÃ¡ficos</li>
      <li onclick="showSection('exportar')">ğŸ“¤ Exportar</li>
      <li onclick="showSection('perfil')">ğŸ‘¤ Perfil</li>
    </ul>
  </nav>

  <main class="main">
    <section id="dashboard" class="active">
      <h2>ğŸ“Š Resumo Geral</h2>
      <div class="card">
        <p>Bem-vindo ao painel da <strong>Valitec MJ</strong>. Acompanhe produtos, setores e status em tempo real.</p>
      </div>
    </section>

    <section id="produtos">
      <h2>ğŸ“¦ Cadastro de Produtos</h2>
      <form id="formProduto" class="card">
        <label>Nome do Produto:</label>
        <input type="text" id="nomeProduto" required>

        <label>CÃ³digo de Barras:</label>
        <input type="text" id="codigoBarras">
        <button type="button" id="scanBtn">ğŸ“· Ler CÃ³digo</button>

        <label>Lote:</label>
        <input type="text" id="lote" required>

        <label>Setor:</label>
        <select id="setor">
          <option>Mercearia</option>
          <option>Bebidas</option>
          <option>Frios</option>
          <option>Higiene</option>
          <option>Limpeza</option>
          <option>AÃ§ougue</option>
        </select>

        <label>Data de Validade:</label>
        <input type="date" id="validade" required>

        <label>Foto do Produto:</label>
        <input type="file" id="fotoProduto" accept="image/*">

        <label>Status:</label>
        <select id="status">
          <option value="pendente">Pendente</option>
          <option value="rebaixado">Rebaixado</option>
          <option value="recuperado">Recuperado</option>
          <option value="vencido">Vencido</option>
        </select>

        <button type="submit">ğŸ’¾ Salvar Produto</button>
      </form>

      <hr>
      <h3>ğŸ“‹ Lista de Produtos</h3>
      <div id="listaProdutos"></div>
    </section>

    <section id="graficos">
      <h2>ğŸ“ˆ GrÃ¡ficos</h2>
      <div class="chart-container card">
        <canvas id="graficoStatus"></canvas>
      </div>
    </section>

    <section id="exportar">
      <h2>ğŸ“¤ Exportar RelatÃ³rios</h2>
      <button id="exportExcel">ğŸ“Š Exportar para Excel</button>
      <button id="exportPDF">ğŸ“„ Exportar para PDF</button>
    </section>

    <section id="perfil">
      <h2>ğŸ‘¤ Meu Perfil</h2>
      <div class="profile card">
        <img src="https://upload.wikimedia.org/wikipedia/commons/a/ac/Default_pfp.jpg" alt="Perfil">
        <p>Logado como: <span id="userEmail">Carregando...</span></p>
        <button id="logoutBtn">ğŸšª Sair</button>
      </div>
    </section>
  </main>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, Timestamp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDPIlkTLbaeUiuvfvijWf5fofREw5oE8ic",
      authDomain: "valitec-mj.firebaseapp.com",
      projectId: "valitec-mj",
      storageBucket: "valitec-mj.firebasestorage.app",
      messagingSenderId: "616592039657",
      appId: "1:616592039657:web:3827a890474111be85da78"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    const menuBtn = document.getElementById("menuBtn");
    const menu = document.getElementById("menu");
    const userEmail = document.getElementById("userEmail");

    // === MENU RESPONSIVO ===
    menuBtn.addEventListener("click", () => {
      menu.classList.toggle("active");
    });

    function showSection(id) {
      document.querySelectorAll("section").forEach(sec => sec.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      if (window.innerWidth < 768) menu.classList.remove("active");
    }

    // === LOGIN STATUS ===
    onAuthStateChanged(auth, user => {
      if (user) {
        userEmail.textContent = user.email;
      } else {
        window.location.href = "login.html";
      }
    });

    document.getElementById("logoutBtn").addEventListener("click", () => signOut(auth));

    // === SALVAR PRODUTO ===
    document.getElementById("formProduto").addEventListener("submit", async (e) => {
      e.preventDefault();
      const nomeProduto = document.getElementById("nomeProduto");
      const codigoBarras = document.getElementById("codigoBarras");
      const lote = document.getElementById("lote");
      const setor = document.getElementById("setor");
      const validade = document.getElementById("validade");
      const status = document.getElementById("status");
      const fotoProduto = document.getElementById("fotoProduto").files[0];
      let fotoURL = "";

      if (fotoProduto) {
        const storageRef = ref(storage, `produtos/${fotoProduto.name}`);
        await uploadBytes(storageRef, fotoProduto);
        fotoURL = await getDownloadURL(storageRef);
      }

      const dados = {
        nome: nomeProduto.value,
        codigo: codigoBarras.value || "",
        lote: lote.value,
        setor: setor.value,
        validade: validade.value,
        status: status.value,
        foto: fotoURL,
        criadoPor: auth.currentUser?.email || "admin",
        criadoEm: Timestamp.now()
      };

      await addDoc(collection(db, "produtos"), dados);
      alert("âœ… Produto salvo com sucesso!");
      e.target.reset();
    });

    // === EXPORTAÃ‡Ã•ES ===
    document.getElementById("exportPDF").addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();
      pdf.setFillColor(10, 15, 31);
      pdf.rect(0, 0, 210, 297, "F");
      pdf.setTextColor(38, 255, 230);
      pdf.setFontSize(16);
      pdf.text("ğŸ“„ RelatÃ³rio Valitec MJ", 20, 20);
      pdf.addImage("https://upload.wikimedia.org/wikipedia/commons/7/7c/Profile_avatar_placeholder_large.png", "PNG", 160, 10, 30, 30);
      pdf.save("ValitecMJ_Relatorio.pdf");
    });

    document.getElementById("exportExcel").addEventListener("click", async () => {
      const querySnapshot = await getDocs(collection(db, "produtos"));
      const produtos = querySnapshot.docs.map(doc => doc.data());
      const ws = XLSX.utils.json_to_sheet(produtos);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Produtos");
      XLSX.writeFile(wb, "ValitecMJ_Produtos.xlsx");
    });

    // === GRÃFICO ===
    const ctx = document.getElementById("graficoStatus");
    new Chart(ctx, {
      type: "bar",
      data: {
        labels: ["Pendente", "Rebaixado", "Recuperado", "Vencido"],
        datasets: [{
          label: "Quantidade",
          data: [12, 5, 8, 3],
          backgroundColor: "#26ffe6"
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
      }
    });
  </script>

  <script>
  // === MOSTRAR SEÃ‡Ã•ES DO DASHBOARD ===
  function showSection(id) {
    // Esconde todas as seÃ§Ãµes
    document.querySelectorAll('main section').forEach(sec => {
      sec.classList.remove('active');
    });

    // Mostra a seÃ§Ã£o clicada
    const target = document.getElementById(id);
    if (target) target.classList.add('active');

    // Fecha o menu se estiver aberto (modo mobile)
    const menu = document.getElementById('menu');
    if (menu.classList.contains('active')) menu.classList.remove('active');
  }
</script>

  <!-- PartÃ­culas -->
  <script src="https://cdn.jsdelivr.net/npm/particles.js"></script>
  <script>
    particlesJS.load('particles', 'particles.json', function () {
      console.log('Particles carregadas!');
    });

  </script>



</body>
</html>
